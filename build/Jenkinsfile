pipeline {
  agent any

  options {
    buildDiscarder(logRotator(numToKeepStr: '3'))
  }

  environment {
    NODE_VERSION = 'v8.12.0'
  }

  stages {
    stage('Checkout') {
      steps {
        checkout scm
      }
    }
    stage('Get dependencies') {
      steps {
          sh 'npm install'
      }
    }
    stage('Execute') {
      steps {
          sh 'npm run test:prod'
        }
    }
  }

  post {
    always {
        cucumber buildStatus: 'UNSTABLE',
                failedFeaturesNumber: 1,
                failedScenariosNumber: 1,
                skippedStepsNumber: 1,
                failedStepsNumber: 1,
                reportTitle: 'My report',
                fileIncludePattern: '**/*cucumber-report.json',
                sortingMethod: 'ALPHABETICAL',
                trendsLimit: 100
    }
  }
}
